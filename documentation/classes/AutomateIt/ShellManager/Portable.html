<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: AutomateIt::ShellManager::Portable</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">AutomateIt::ShellManager::Portable</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/automateit/shell_manager/portable_rb.html">
                lib/automateit/shell_manager/portable.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="BaseDriver.html">
                AutomateIt::ShellManager::BaseDriver
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h2><a href="Portable.html">ShellManager::Portable</a></h2>
<p>
Pure-Ruby, portable driver for <a
href="../ShellManager.html">ShellManager</a> provides Unix-like shell
commands for manipulating files and executing commands.
</p>
<p>
It does not provide commands for:
</p>
<ul>
<li>which

</li>
<li>which!

</li>
</ul>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000132">_present?</a>&nbsp;&nbsp;
      <a href="#M000107">backup</a>&nbsp;&nbsp;
      <a href="#M000113">cd</a>&nbsp;&nbsp;
      <a href="#M000127">chmod</a>&nbsp;&nbsp;
      <a href="#M000128">chmod_R</a>&nbsp;&nbsp;
      <a href="#M000129">chown</a>&nbsp;&nbsp;
      <a href="#M000130">chown_R</a>&nbsp;&nbsp;
      <a href="#M000126">chperm</a>&nbsp;&nbsp;
      <a href="#M000119">cp</a>&nbsp;&nbsp;
      <a href="#M000121">cp_R</a>&nbsp;&nbsp;
      <a href="#M000120">cp_r</a>&nbsp;&nbsp;
      <a href="#M000118">install</a>&nbsp;&nbsp;
      <a href="#M000115">mkdir</a>&nbsp;&nbsp;
      <a href="#M000116">mkdir_p</a>&nbsp;&nbsp;
      <a href="#M000109">mktemp</a>&nbsp;&nbsp;
      <a href="#M000110">mktempdir</a>&nbsp;&nbsp;
      <a href="#M000111">mktempdircd</a>&nbsp;&nbsp;
      <a href="#M000122">mv</a>&nbsp;&nbsp;
      <a href="#M000105">provides_mode?</a>&nbsp;&nbsp;
      <a href="#M000106">provides_ownership?</a>&nbsp;&nbsp;
      <a href="#M000114">pwd</a>&nbsp;&nbsp;
      <a href="#M000123">rm</a>&nbsp;&nbsp;
      <a href="#M000124">rm_r</a>&nbsp;&nbsp;
      <a href="#M000125">rm_rf</a>&nbsp;&nbsp;
      <a href="#M000117">rmdir</a>&nbsp;&nbsp;
      <a href="#M000108">sh</a>&nbsp;&nbsp;
      <a href="#M000131">touch</a>&nbsp;&nbsp;
      <a href="#M000112">umask</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FILE_MASK</td>
          <td>=</td>
          <td class="context-item-value">0100000</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DIRECTORY_MASK</td>
          <td>=</td>
          <td class="context-item-value">040000</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">backup</span><span class="method-args">(*sources)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#backup
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 32</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">backup</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">sources</span>)
    <span class="ruby-identifier">sources</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">args_and_opts</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">sources</span>)

    <span class="ruby-identifier">targets</span> = []
    <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">source</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">sources</span>
      <span class="ruby-identifier">is_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">source</span>)

      <span class="ruby-identifier">tempster_opts</span> = {
        <span class="ruby-identifier">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
        <span class="ruby-identifier">:noop</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noop?</span>,
        <span class="ruby-identifier">:delete</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
        <span class="ruby-identifier">:dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">source</span>),
        <span class="ruby-identifier">:prefix</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;%s.%s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">source</span>), <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>],
        <span class="ruby-identifier">:suffix</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;.bak&quot;</span>,
        <span class="ruby-identifier">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">is_dir</span> <span class="ruby-value">? </span><span class="ruby-operator">:</span><span class="ruby-identifier">directory</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:file</span>,
      }

      <span class="ruby-identifier">target</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Tempster</span>.<span class="ruby-identifier">tempster</span>(<span class="ruby-identifier">tempster_opts</span>)

      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">silence</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:quiet</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">WARN</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">log</span>.<span class="ruby-identifier">level</span>) <span class="ruby-keyword kw">do</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_dir</span>
          <span class="ruby-identifier">cp_opts</span> = {}
          <span class="ruby-identifier">cp_opts</span>[<span class="ruby-identifier">:recursive</span>] = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_dir</span>
          <span class="ruby-identifier">cp_opts</span>[<span class="ruby-identifier">:preserve</span>] = <span class="ruby-identifier">:try</span>

          <span class="ruby-identifier">source_children</span> = <span class="ruby-identifier">_directory_contents</span>(<span class="ruby-identifier">source</span>)
          <span class="ruby-comment cmt">#puts &quot;sc: %s&quot; % source_children.inspect</span>

          <span class="ruby-identifier">interpreter</span>.<span class="ruby-identifier">cp_r</span>(<span class="ruby-identifier">source_children</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">cp_opts</span>)
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">interpreter</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">targets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">target</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sources</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">targets</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="#M000113" class="method-signature">
          <span class="method-name">cd</span><span class="method-args">(dir, opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#cd
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000113-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 124</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cd</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">enqueue</span>(<span class="ruby-identifier">:info</span>, <span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span>(<span class="ruby-identifier">block</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;pushd&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;cd&quot;</span>)<span class="ruby-operator">+</span><span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">dir</span>)
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writing?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">dir</span>)
          <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cd</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">true</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">dequeue</span>(<span class="ruby-identifier">:info</span>, <span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;popd # =&gt; #{pwd}&quot;</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cd</span>(<span class="ruby-identifier">dir</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writing?</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">dir</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000127" class="method-detail">
        <a name="M000127"></a>

        <div class="method-heading">
          <a href="#M000127" class="method-signature">
          <span class="method-name">chmod</span><span class="method-args">(mode, targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#chmod
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000127-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000127-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 454</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">chperm</span>(<span class="ruby-identifier">targets</span>, {<span class="ruby-identifier">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mode</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000128" class="method-detail">
        <a name="M000128"></a>

        <div class="method-heading">
          <a href="#M000128" class="method-signature">
          <span class="method-name">chmod_R</span><span class="method-args">(mode, targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#chmod_R
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000128-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000128-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 459</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chmod_R</span>(<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">targets</span>, {<span class="ruby-identifier">:recursive</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000129" class="method-detail">
        <a name="M000129"></a>

        <div class="method-heading">
          <a href="#M000129" class="method-signature">
          <span class="method-name">chown</span><span class="method-args">(user, group, targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#chown
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000129-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000129-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 464</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chown</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">group</span>, <span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">chperm</span>(<span class="ruby-identifier">targets</span>, {<span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000130" class="method-detail">
        <a name="M000130"></a>

        <div class="method-heading">
          <a href="#M000130" class="method-signature">
          <span class="method-name">chown_R</span><span class="method-args">(user, group, targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#chown_R
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000130-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000130-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 469</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chown_R</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">group</span>, <span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">chown</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">group</span>, <span class="ruby-identifier">targets</span>, {<span class="ruby-identifier">:recursive</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000126" class="method-detail">
        <a name="M000126"></a>

        <div class="method-heading">
          <a href="#M000126" class="method-signature">
          <span class="method-name">chperm</span><span class="method-args">(targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#chperm
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000126-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000126-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 369</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chperm</span>(<span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">_replace_owner_with_user</span>(<span class="ruby-identifier">opts</span>)
    <span class="ruby-identifier">user</span> = \
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>]
        <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>] = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
          <span class="ruby-keyword kw">begin</span>
            <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getpwnam</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>]).<span class="ruby-identifier">uid</span>
          <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>
            <span class="ruby-identifier">:not_present</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>]
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">group</span> = \
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>]
        <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>] = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
          <span class="ruby-keyword kw">begin</span>
            <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getgrnam</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>]).<span class="ruby-identifier">gid</span>
          <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>
            <span class="ruby-identifier">:not_present</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>]
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">modified_entries</span> = []
    <span class="ruby-identifier">modified_ownership</span> = <span class="ruby-keyword kw">false</span>
    <span class="ruby-identifier">modified_permission</span> = <span class="ruby-keyword kw">false</span>
    <span class="ruby-constant">Find</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">targets</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">modified</span> = <span class="ruby-keyword kw">false</span>
      <span class="ruby-identifier">stat</span> = <span class="ruby-identifier">writing?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:mode</span>]
        <span class="ruby-comment cmt"># TODO ShellManager::Portable#chperm -- process chmod symbolic strings, e.g., [ugoa...][[+-=][rwxXstugo...]...][,...]</span>
        <span class="ruby-identifier">mode</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:mode</span>] <span class="ruby-operator">|</span> (<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-value">? </span><span class="ruby-constant">DIRECTORY_MASK</span> <span class="ruby-operator">:</span> <span class="ruby-constant">FILE_MASK</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stat</span>
        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">stat</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">mode</span> <span class="ruby-operator">^</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">mode</span>).<span class="ruby-identifier">zero?</span>
          <span class="ruby-identifier">modified</span> = <span class="ruby-keyword kw">true</span>
          <span class="ruby-identifier">modified_permission</span> = <span class="ruby-keyword kw">true</span>
          <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writing?</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">stat</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">uid</span>)
        <span class="ruby-identifier">modified</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-identifier">modified_ownership</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">chown</span>(<span class="ruby-identifier">user</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writing?</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">group</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">stat</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">group</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">gid</span>)
        <span class="ruby-identifier">modified</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-identifier">modified_ownership</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">chown</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">group</span>, <span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writing?</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">modified_entries</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modified</span>
      <span class="ruby-constant">Find</span>.<span class="ruby-identifier">prune</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modified_entries</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">display_entries</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:details</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">modified_entries</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">targets</span>
    <span class="ruby-identifier">display_entries</span> = [<span class="ruby-identifier">display_entries</span>].<span class="ruby-identifier">flatten</span>

    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modified_permission</span>
      <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;chmod&quot;</span>
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; -R&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; 0%o&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:mode</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:mode</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">display_entries</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-identifier">msg</span>)
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modified_ownership</span>
      <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;chown&quot;</span>
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; -R&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">display_entries</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-identifier">msg</span>)
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">modified_entries</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">modified_entries</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">cp</span><span class="method-args">(sources, target, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#cp
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 210</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cp</span>(<span class="ruby-identifier">sources</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-comment cmt"># TODO ShellManager::Portable#cp -- rather funky, needs a code review</span>
    <span class="ruby-identifier">fu_opts</span> = <span class="ruby-identifier">_fileutils_opts</span>
    <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">opt</span> <span class="ruby-keyword kw">in</span> [<span class="ruby-identifier">:noop</span>, <span class="ruby-identifier">:verbose</span>]
      <span class="ruby-identifier">opt</span> = <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-identifier">fu_opts</span>[<span class="ruby-identifier">opt</span>] = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">opt</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">opt</span>]
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">fu_opts_with_preserve</span> = <span class="ruby-identifier">fu_opts</span>.<span class="ruby-identifier">clone</span>
    <span class="ruby-identifier">fu_opts_with_preserve</span>[<span class="ruby-identifier">:preserve</span>] = \
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:preserve</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:try</span>
        <span class="ruby-identifier">fsim</span> = <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">Stat</span>.<span class="ruby-identifier">instance_methods</span>
        (<span class="ruby-identifier">fsim</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;uid&quot;</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">fsim</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;gid&quot;</span>) <span class="ruby-keyword kw">and</span>
         <span class="ruby-identifier">fsim</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;mode&quot;</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">fsim</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;atime&quot;</span>))
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:preserve</span>]
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">changed</span> = []
    <span class="ruby-identifier">sources_a</span> = [<span class="ruby-identifier">sources</span>].<span class="ruby-identifier">flatten</span>
    <span class="ruby-identifier">sources_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">parent</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">Find</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">parent</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">source_fn</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">child</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">child</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">child</span>
        <span class="ruby-identifier">target_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">target</span>)
        <span class="ruby-identifier">target_fn</span> = <span class="ruby-identifier">peer_for</span>(<span class="ruby-identifier">source_fn</span>, <span class="ruby-identifier">target</span>)

        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-constant">PNOTE</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;comparing %s =&gt; %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">source_fn</span>, <span class="ruby-identifier">target_fn</span>])
        <span class="ruby-identifier">source_st</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">source_fn</span>)
        <span class="ruby-identifier">is_copy</span> = <span class="ruby-keyword kw">false</span>
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-keyword kw">begin</span>
            <span class="ruby-identifier">target_st</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">target_fn</span>)

            <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">target_dir</span>
              <span class="ruby-comment cmt"># Is the file obviously different?</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">file?</span>
                <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">kind</span> <span class="ruby-keyword kw">in</span> <span class="ruby-node">%w(size mtime)</span>
                  <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">kind</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;mtime&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:preserve</span>]
                  <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">kind</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">target_st</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">kind</span>)
                    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-constant">PNOTE</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;%s not same %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">target_fn</span>, <span class="ruby-identifier">kind</span>])
                    <span class="ruby-identifier">raise</span> <span class="ruby-constant">EOFError</span>.<span class="ruby-identifier">new</span>
                  <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">end</span>

                <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">identical?</span>(<span class="ruby-identifier">source_fn</span>, <span class="ruby-identifier">target_fn</span>)
                  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-constant">PNOTE</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;%s not identical&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">target_fn</span>)
                  <span class="ruby-identifier">raise</span> <span class="ruby-constant">EOFError</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-keyword kw">end</span>
              <span class="ruby-keyword kw">end</span>

              <span class="ruby-comment cmt"># File just needs to be altered</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:preserve</span>]
                <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">mode</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">target_st</span>.<span class="ruby-identifier">mode</span>
                  <span class="ruby-identifier">changed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
                  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-constant">PNOTE</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;%s not same mode&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">target_fn</span>)
                  <span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">target_fn</span>, <span class="ruby-identifier">fu_opts</span>)
                <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">uid</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">target_st</span>.<span class="ruby-identifier">uid</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">gid</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">target_st</span>.<span class="ruby-identifier">gid</span>
                  <span class="ruby-identifier">changed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
                  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-constant">PNOTE</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;%s not same uid/gid&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">target_fn</span>)
                  <span class="ruby-identifier">chown</span>(<span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">uid</span>, <span class="ruby-identifier">source_st</span>.<span class="ruby-identifier">gid</span>, <span class="ruby-identifier">target_fn</span>, <span class="ruby-identifier">fu_opts</span>)
                <span class="ruby-keyword kw">end</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">EOFError</span>
            <span class="ruby-identifier">changed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
            <span class="ruby-identifier">is_copy</span> = <span class="ruby-keyword kw">true</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
          <span class="ruby-identifier">changed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-constant">PNOTE</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;%s not present&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">target_fn</span>)
          <span class="ruby-identifier">is_copy</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_copy</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;cp%s %s %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>] <span class="ruby-operator">?</span> <span class="ruby-value str">' -r'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">source_fn</span>, <span class="ruby-identifier">target_fn</span>])
          <span class="ruby-comment cmt">## puts &quot;fo %s&quot; % fu_opts.inspect</span>
          <span class="ruby-comment cmt">## puts &quot;fowp %s&quot; % fu_opts_with_preserve.inspect</span>
          <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp_r</span>(<span class="ruby-identifier">source_fn</span>, <span class="ruby-identifier">target_fn</span>, <span class="ruby-identifier">fu_opts_with_preserve</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">result</span> = \
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">changed</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword kw">false</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sources_a</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
          <span class="ruby-identifier">changed</span>.<span class="ruby-identifier">first</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">changed</span>.<span class="ruby-identifier">uniq</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">cp_R</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#cp_R
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 311</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cp_R</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
    <span class="ruby-identifier">cp_r</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">cp_r</span><span class="method-args">(sources, target, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#cp_r
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 306</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cp_r</span>(<span class="ruby-identifier">sources</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">cp</span>(<span class="ruby-identifier">sources</span>, <span class="ruby-identifier">target</span>, {<span class="ruby-identifier">:recursive</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000118" class="method-detail">
        <a name="M000118"></a>

        <div class="method-heading">
          <a href="#M000118" class="method-signature">
          <span class="method-name">install</span><span class="method-args">(source, target, mode=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#install
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000118-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 194</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">mode</span>=<span class="ruby-keyword kw">nil</span>)
    <span class="ruby-identifier">cp_rv</span> = <span class="ruby-keyword kw">nil</span>
    <span class="ruby-identifier">chmod_rv</span> = <span class="ruby-keyword kw">nil</span>
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">silence</span>(<span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">WARN</span>) <span class="ruby-keyword kw">do</span>
      <span class="ruby-identifier">cp_rv</span> = <span class="ruby-identifier">cp</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)
      <span class="ruby-identifier">chmod_rv</span> = <span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">peer_for</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mode</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">cp_rv</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">chmod_rv</span>

    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;install%s %s %s&quot;</span> <span class="ruby-operator">%</span>
             [<span class="ruby-identifier">mode</span> <span class="ruby-value">? </span><span class="ruby-value str">' -m 0%o'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">mode</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">target</span>])
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">source</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <a href="#M000115" class="method-signature">
          <span class="method-name">mkdir</span><span class="method-args">(dirs, opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#mkdir
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000115-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000115-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 150</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">dirs</span>, <span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">_replace_owner_with_user</span>(<span class="ruby-identifier">opts</span>)
    <span class="ruby-identifier">kind</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:parents</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:mkdir_p</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:mkdir</span>
    <span class="ruby-identifier">missing</span> = [<span class="ruby-identifier">dirs</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">dir</span>)}
    <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">missing</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">block</span>
      <span class="ruby-identifier">chperm</span>(<span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:mode</span>]
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">missing</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">kind</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/_/</span>, <span class="ruby-value str">' -'</span>)
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{cmd} #{missing.join(&quot; &quot;)}&quot;</span>)
      <span class="ruby-identifier">result</span> = [<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">missing</span>, <span class="ruby-identifier">_fileutils_opts</span>)].<span class="ruby-identifier">flatten</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> [<span class="ruby-identifier">dirs</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">missing</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
          <span class="ruby-value str">&quot;can only use a block if you mkdir a single directory&quot;</span>)
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">dir</span> = [<span class="ruby-identifier">dirs</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">first</span>
      <span class="ruby-identifier">cd</span>(<span class="ruby-identifier">dir</span>) <span class="ruby-keyword kw">do</span>
        <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">result</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">chperm</span>(<span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:group</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:mode</span>]
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">missing</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <a href="#M000116" class="method-signature">
          <span class="method-name">mkdir_p</span><span class="method-args">(dirs, opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#mkdir_p
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000116-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000116-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 180</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">dirs</span>, <span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">dirs</span>, {<span class="ruby-identifier">:parents</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">mktemp</span><span class="method-args">(name=nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#mktemp
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 88</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mktemp</span>(<span class="ruby-identifier">name</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">_mktemp_helper</span>(<span class="ruby-identifier">:mktemp</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">mktempdir</span><span class="method-args">(name=nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#mktempdir
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 93</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mktempdir</span>(<span class="ruby-identifier">name</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">_mktemp_helper</span>(<span class="ruby-identifier">:mktempdir</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">mktempdircd</span><span class="method-args">(name=nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#mktempdircd
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 98</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mktempdircd</span>(<span class="ruby-identifier">name</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">_mktemp_helper</span>(<span class="ruby-identifier">:mktempdircd</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">mv</span><span class="method-args">(sources, target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#mv
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 316</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mv</span>(<span class="ruby-identifier">sources</span>, <span class="ruby-identifier">target</span>)
    <span class="ruby-identifier">present</span> = [<span class="ruby-identifier">sources</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">_present?</span>(<span class="ruby-identifier">entry</span>)}
    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">present</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">present</span> = <span class="ruby-identifier">present</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">present</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span>(<span class="ruby-identifier">present</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">_fileutils_opts</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">present</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">present</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">provides_mode?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 21</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">provides_mode?</span>
    <span class="ruby-operator">!</span> <span class="ruby-identifier">broken?</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">provides_ownership?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 25</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">provides_ownership?</span>
    <span class="ruby-operator">!</span> <span class="ruby-identifier">broken?</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <a href="#M000114" class="method-signature">
          <span class="method-name">pwd</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#pwd
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000114-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000114-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 145</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pwd</span>()
    <span class="ruby-keyword kw">return</span> <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">pwd</span>()
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">rm</span><span class="method-args">(targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#rm
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 325</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rm</span>(<span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">kind</span> = \
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:force</span>]
        <span class="ruby-identifier">:rm_rf</span>
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>]
        <span class="ruby-identifier">:rm_r</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">:rm</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">present</span> = [<span class="ruby-identifier">targets</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">_present?</span>(<span class="ruby-identifier">entry</span>)}
    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">present</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;rm&quot;</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:force</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; -rf&quot;</span>
    <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:recursive</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; -r&quot;</span>
    <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:force</span>]
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; -f&quot;</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">present</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-identifier">msg</span>)

    <span class="ruby-identifier">present</span> = <span class="ruby-identifier">present</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">present</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">present</span>, <span class="ruby-identifier">_fileutils_opts</span>)
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">present</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">rm_r</span><span class="method-args">(targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#rm_r
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 356</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rm_r</span>(<span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">rm</span>(<span class="ruby-identifier">targets</span>, {<span class="ruby-identifier">:recursive</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">rm_rf</span><span class="method-args">(targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#rm_rf
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 361</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">rm</span>(<span class="ruby-identifier">targets</span>, {<span class="ruby-identifier">:recursive</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:force</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000117" class="method-detail">
        <a name="M000117"></a>

        <div class="method-heading">
          <a href="#M000117" class="method-signature">
          <span class="method-name">rmdir</span><span class="method-args">(dirs)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#rmdir
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000117-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 185</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rmdir</span>(<span class="ruby-identifier">dirs</span>)
    <span class="ruby-identifier">present</span> = [<span class="ruby-identifier">dirs</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">dir</span>)}
    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">present</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;rmdir #{String === dirs ? dirs : dirs.join(' ')}&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span>(<span class="ruby-identifier">present</span>, <span class="ruby-identifier">_fileutils_opts</span>)
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">present</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">sh</span><span class="method-args">(*commands)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#sh
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 72</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sh</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">commands</span>)
    <span class="ruby-identifier">args</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">args_and_opts</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">commands</span>)
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{args.join(' ')}&quot;</span>)
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">writing?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">system</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000131" class="method-detail">
        <a name="M000131"></a>

        <div class="method-heading">
          <a href="#M000131" class="method-signature">
          <span class="method-name">touch</span><span class="method-args">(targets, opts={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#touch
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000131-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000131-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 474</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">touch</span>(<span class="ruby-identifier">targets</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">like</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:like</span>)
    <span class="ruby-identifier">stamp</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:stamp</span>)
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:quiet</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-identifier">time</span> = \
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stamp</span>
        <span class="ruby-identifier">stamp</span>
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">like</span>
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">like</span>).<span class="ruby-identifier">mtime</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">preview?</span>
            <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">quiet</span>
      <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;touch&quot;</span>
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; --reference %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">like</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">like</span>
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; --stamp %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">stamp</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stamp</span>
      <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">targets</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span>(<span class="ruby-constant">PEXEC</span><span class="ruby-operator">+</span><span class="ruby-identifier">msg</span>)
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">results</span> = []
    <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">target</span> <span class="ruby-keyword kw">in</span> [<span class="ruby-identifier">targets</span>].<span class="ruby-identifier">flatten</span>
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">stat</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">target</span>)
        <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">mtime</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">to_i</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">target</span>, <span class="ruby-value str">&quot;a&quot;</span>){} <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">preview?</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">utime</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">time</span>, <span class="ruby-identifier">target</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">preview?</span>
      <span class="ruby-identifier">results</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">target</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">results</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="#M000112" class="method-signature">
          <span class="method-name">umask</span><span class="method-args">(mode=nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See ShellManager#umask
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000112-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 103</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">umask</span>(<span class="ruby-identifier">mode</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mode</span>
      <span class="ruby-identifier">old</span> = <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">umask</span>
      <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">umask</span>(<span class="ruby-identifier">mode</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
        <span class="ruby-keyword kw">ensure</span>
          <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">umask</span>(<span class="ruby-identifier">old</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">umask</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000132" class="method-detail">
        <a name="M000132"></a>

        <div class="method-heading">
          <a href="#M000132" class="method-signature">
          <span class="method-name">_present?</span><span class="method-args">(path)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is the file or symlink at this <tt>path</tt> present?
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000132-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000132-source">
<pre>
<span class="ruby-comment cmt"># File lib/automateit/shell_manager/portable.rb, line 520</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_present?</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">symlink?</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>