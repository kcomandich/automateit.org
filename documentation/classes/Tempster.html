<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Tempster</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Tempster</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/tempster_rb.html">
                lib/tempster.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h2><a href="Tempster.html">Tempster</a></h2>
<p>
<a href="Tempster.html">Tempster</a> is a pure-Ruby library for creating
temporary files and directories. Unlike other tools, it can create both
temporary files and directories, and is designed to be secure, thread-safe,
easy-to-use, powerful thanks to user-configurable options, and
user-friendly thanks to good defaults so you don&#8216;t need to provide
any arguments.
</p>
<p>
Why write another library for this? The Tempfile standard library provides
no way to create temporary directories and always deletes the files it
creates, even if you want to keep them. The MkTemp gem is insecure and
fails on collisions. Linux &quot;<a
href="Tempster.html#M000014">mktemp</a>&quot; works fine but is
platform-specific. Therefore, I had to write something.
</p>
<h3>WARNING: Using &#8216;cd&#8217; and :noop together can be dangerous!</h3>
<p>
<a href="Tempster.html">Tempster</a> will only <b>pretend</b> to make
directories in :noop (no-operation) mode. In :noop mode, it will also only
<b>pretend</b> to change into the directory when using :cd or <tt><a
href="Tempster.html#M000016">mktempdircd</a></tt>.
</p>
<p>
This can be <b>disastrous</b> if you&#8216;re executing non-AutomateIt
commands (e.g. <tt>system</tt>) that use <b>relative</b> <b>paths</b> and
expect to be run inside the newly-created temporary directory because the
<tt>chdir</tt> didn&#8216;t actually happen.
</p>
<p>
Read <a href="../files/docs/previews_txt.html">previews.txt</a> for
instructions on how to write code that can be safely previewed.
</p>
<h2>Credits</h2>
<ul>
<li>Random string generator taken from <a
href="http://pleac.sourceforge.net/pleac_ruby/numbers.html">pleac.sourceforge.net/pleac_ruby/numbers.html</a>

</li>
</ul>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000013">_armor_string</a>&nbsp;&nbsp;
      <a href="#M000014">mktemp</a>&nbsp;&nbsp;
      <a href="#M000015">mktempdir</a>&nbsp;&nbsp;
      <a href="#M000016">mktempdircd</a>&nbsp;&nbsp;
      <a href="#M000012">tempster</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Tempster/Messager.html" class="link">Tempster::Messager</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_PREFIX</td>
          <td>=</td>
          <td class="context-item-value">&quot;tempster&quot;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_FILE_MODE</td>
          <td>=</td>
          <td class="context-item-value">0600</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_DIRECTORY_MODE</td>
          <td>=</td>
          <td class="context-item-value">0700</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_ARMOR_LENGTH</td>
          <td>=</td>
          <td class="context-item-value">10</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ARMOR_CHARACTERS</td>
          <td>=</td>
          <td class="context-item-value">[&quot;A&quot;..&quot;Z&quot;,&quot;a&quot;..&quot;z&quot;,&quot;0&quot;..&quot;9&quot;].collect{|r| r.to_a}.join</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">_armor_string</span><span class="method-args">(length=DEFAULT_ARMOR_LENGTH)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a string of random characters.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
<span class="ruby-comment cmt"># File lib/tempster.rb, line 146</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">_armor_string</span>(<span class="ruby-identifier">length</span>=<span class="ruby-constant">DEFAULT_ARMOR_LENGTH</span>)
    (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">length</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-constant">ARMOR_CHARACTERS</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-constant">ARMOR_CHARACTERS</span>.<span class="ruby-identifier">size</span>)]}.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;C*&quot;</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">mktemp</span><span class="method-args">(opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a temporary file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
<span class="ruby-comment cmt"># File lib/tempster.rb, line 151</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mktemp</span>(<span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">tempster</span>({<span class="ruby-identifier">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:file</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">mktempdir</span><span class="method-args">(opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a temporary directory.
</p>
<p>
<b>WARNING</b>: See WARNING text at the top of this class&#8216;s
documentation!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
<span class="ruby-comment cmt"># File lib/tempster.rb, line 158</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mktempdir</span>(<span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">tempster</span>({<span class="ruby-identifier">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:directory</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)

  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">mktempdircd</span><span class="method-args">(opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a temporary directory and changes into it using <tt>chdir</tt>.
This is a shortcut for using <tt><a
href="Tempster.html#M000015">mktempdir</a></tt> with the <tt>:cd =&gt;
true</tt> option.
</p>
<p>
<b>WARNING</b>: See WARNING text at the top of this class&#8216;s
documentation!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
<span class="ruby-comment cmt"># File lib/tempster.rb, line 167</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mktempdircd</span>(<span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">tempster</span>({<span class="ruby-identifier">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:directory</span>, <span class="ruby-identifier">:cd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">tempster</span><span class="method-args">(opts={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Options:
</p>
<ul>
<li>:kind &#8212; Create a :file or :directory, required.

</li>
<li>:prefix &#8212; String to prefix the temporary name with, defaults to
&quot;<a href="Tempster.html#M000012">tempster</a>&quot;.

</li>
<li>:suffix &#8212; String to suffix the temporary name with, defaults is no
suffix.

</li>
<li>:name &#8212; Same as :prefix

</li>
<li>:dir &#8212; Base directory to create temporary entries in, uses
system-wide temporary directory (e.g., <tt>/tmp</tt>) by default.

</li>
<li>:cd &#8212; Change into the newly directory created using <tt>ch</tt>
within the block, and then switch back to the previous directory. Only used
when a block is given and the :kind is :directory. Default is false. See
WARNING at the top of this class&#8216;s documentation!

</li>
<li>:noop &#8212; no-operation mode, pretends to do actions without actually
creating or deleting temporary entries. Default is false. WARNING: See
WARNING at the top of this class&#8216;s documentation!

</li>
<li>:verbose &#8212; Print status messages about creating and deleting the
temporary entries. Default is false.

</li>
<li>:delete &#8212; Delete the temporary entries when exiting block. Default is
true when given a block, false otherwise. If you don&#8216;t use a block,
you&#8216;re responsible for deleting the entries yourself.

</li>
<li>:tries &#8212; Number of tries to create a temporary entry, usually
it&#8216;ll succeed on the first try. Default is 10.

</li>
<li>:armor &#8212; Length of armor to append to the prefix. These are random
characters padding out the temporary entry names to prevent them from using
existing files. If you have a very short armor, you&#8216;re likely to get
a collision and the algorithm will have to try again for the specified
number of <tt>tries</tt>.

</li>
<li>:message_callback &#8212; <tt>lambda</tt> called when there&#8216;s a
message, e.g., <tt>lambda{|message| puts message}</tt>, regardless of
:verbose state. By default :messaging is nil and messages are printed to
STDOUT only when :verbose is true.

</li>
<li>:message_prefix &#8212; String to put in front of messages, e.g., &quot;#
&quot;

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
<span class="ruby-comment cmt"># File lib/tempster.rb, line 60</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tempster</span>(<span class="ruby-identifier">opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">kind</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:kind</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;'kind' option not specified&quot;</span>)
    <span class="ruby-identifier">prefix</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:prefix</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:name</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_PREFIX</span>
    <span class="ruby-identifier">suffix</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:suffix</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">nil</span>
    <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:dir</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span>
    <span class="ruby-identifier">cd</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:cd</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-identifier">noop</span> =  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:noop</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-identifier">verbose</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:verbose</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-identifier">delete</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:delete</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-identifier">tries</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:tries</span>) <span class="ruby-operator">||</span> <span class="ruby-value">10</span>
    <span class="ruby-identifier">armor</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:armor</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_ARMOR_LENGTH</span>
    <span class="ruby-identifier">message_callback</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:message_callback</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">nil</span>
    <span class="ruby-identifier">message_prefix</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:message_prefix</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
    <span class="ruby-identifier">mode</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:mode</span>) <span class="ruby-operator">||</span> \
      <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">kind</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:file</span>
        <span class="ruby-constant">DEFAULT_FILE_MODE</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:directory</span>
        <span class="ruby-constant">DEFAULT_DIRECTORY_MODE</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;unknown kind: #{kind}&quot;</span>)
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;can only use 'delete' option with block&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">delete</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;can only use 'cd' with directories and blocks&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cd</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;unknown extra options: #{opts.inspect}&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">messager</span> = <span class="ruby-constant">Messager</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">verbose</span>, <span class="ruby-identifier">message_callback</span>, <span class="ruby-identifier">message_prefix</span>)

    <span class="ruby-identifier">path</span> = <span class="ruby-keyword kw">nil</span>
    <span class="ruby-identifier">success</span> = <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">tries</span>
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">name</span> = <span class="ruby-identifier">prefix</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">_armor_string</span>(<span class="ruby-identifier">armor</span>)
        <span class="ruby-identifier">name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">suffix</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">suffix</span>
        <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">name</span>)

        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">noop</span>
          <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">kind</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:file</span>
            <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">RDWR</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCL</span>).<span class="ruby-identifier">close</span>
            <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">path</span>)
          <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:directory</span>
            <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">mode</span>)
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;unknown kind: #{kind}&quot;</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">message</span> = <span class="ruby-value str">&quot;mktempster --mode=0%o --kind=%s --dir=%s --prefix=%s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">mode</span>, <span class="ruby-identifier">kind</span>, <span class="ruby-identifier">dir</span>, <span class="ruby-identifier">prefix</span>]
        <span class="ruby-identifier">message</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-value str">&quot; --suffix=%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">suffix</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">suffix</span>
        <span class="ruby-identifier">message</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-value str">&quot; # =&gt; %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
        <span class="ruby-identifier">success</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-keyword kw">break</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EEXIST</span>
        <span class="ruby-comment cmt"># Try again</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">IOError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;couldn't create temporary #{kind}, &quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">success</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
      <span class="ruby-identifier">previous</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cd</span>
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cd</span>
          <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">noop</span>
          <span class="ruby-identifier">messager</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;pushd #{path}&quot;</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-comment cmt"># Re-throw exception after cleaning up</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cd</span>
          <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">previous</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">noop</span>
          <span class="ruby-identifier">messager</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;popd # =&gt; #{previous}&quot;</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">delete</span>
          <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">noop</span>
          <span class="ruby-identifier">messager</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;rm -rf #{path}&quot;</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">path</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>